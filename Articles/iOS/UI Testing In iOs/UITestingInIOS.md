\*\* UI Testing in iOS\*\*

Создание любого программного продукта начинается с изучения требований и
тщательной проработки его архитектуры. После этого, а иногда и одновременно с
подготовкой начинается процесс программирования. Немаловажную часть процесса
разработки занимает тестирование продукта на всех стадиях его производства.
Инженеры по качеству QA (quality assurance) вовлечены в процесс разработки с
самого начала проекта. Они так же как и разработчики изучают требования,
тестируют спецификацию (если таковая имеется:-) ), создают тестовую документацию
и проводят тестирование продукта на протяжении всего процесса разработки. Для
сокращения нагрузки на QA отдел, для выявления привнесенных багов в уже
отложенные участки кода, для решения интеграционных проблем и, самое главное,
для повышения качества конечного продукта, применяется непрерывная интеграция
(CI - Continuous Integration).

Начиная с 5-й версии в Xcode добавлена поддержка CI. Как и все продукты
предоставляемые компанией Apple, непрерывная интеграция не сложно настраивается
и работает, как говорят, “из коробки”.

Немаловажной частью CI является написание и поддержка юнит-тестов. При создании
нового проекта в Xcode 5/6 автоматически создается каталог для юнит-тестов и
один тестовый файл. Однако Xcode 5/6 не позволяет производить тестирование
пользовательского интерфейса (UI).

Тестирование UI при создании iOS приложений по прежнему ложилось на плечи QA
отдела или же программистам приходилось пользоваться сторонними решениями. Одно
из таких решений - фреймворк [KIF](<https://github.com/kif-framework/KIF>)
(KIF). 

При использовании KIF для тестирования UI доступ к UI элементам, например
UIButton, UItextField, UIlabel осуществляется при помощи задания в storyboard
или .xib файле accessibility label для каждого элемента, который нужно
протестировать.

Для того, чтобы создать мок объект необходимо добавить в проект новый таргет,
который является копией трестируемого таргета и только вместо реальных объектов
в нем используются мок объекты.

C примером тестирования пользовательского интерфейса при помощи KIF можно
ознакомиться [здесь](<https://github.com/iQueSoft/iOSDemo_KIFSample>), (см.
таргет UI Tests).  

В 7-й версии при создании нового проекта Xcode опционально предлагает включить в
него юнит тесты и UI тесты. В уже существующий проект UI тесты можно добавить
следующим образом: (File \> New \> Target \> Test \> Cocoa Touch UI Testing
Bundle). Как и в XCTest каждый тест должен начинаться со слова test. Все, что
нужно сделать для создания UI теста - это создать пустой метод, начинающийся со
слова test. Поставить курсор в тело теста, нажать кнопку записи.

![](<PicStartTest.png>)

Выполнить необходимые действия на симуляторе, которые должен будет делать
будущий тест. При нажатии на каждый UI элемент Xcode автоматически создает
строку кода в тестовом методе.

![](<picProcessTest.png>)

Для остановки записи теста необходимо нажать кнопку записи еще раз.

![](<PicStopTest.png>)

Для того, чтобы тест был готов остается только добавить необходимые утверждения
(XCTAsserts).

Если нужно создать новый тест на основе существующего, или изменить
существующий, то можно поставить брекпоинт в тесте и запустить его на
выполнение. И когда выполнение теста будет остановлено начать запись, это
позволит создать продолжение теста.  
Для того, чтобы использовать мок объект при выполнении тестирования необходимо,
создать объект XCUIApplication заполнить массив launchArguments одной или
несколькими строками и после этого послать созданному объекту сообщение launch.
Например, 

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    XCUIApplication *app = [[XCUIApplication alloc] init];

    app.launchArguments = @[@"StringToUseMockObjects"];

    [app launch];
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Этот код можно добавлять в начале каждого тестового метода, или в методе setUp,
который вызывается перед выполнением каждого теста в файле.

После этого в местах, где нужно подменить реальный объект мок объектом можно
использовать:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    if([[NSProcessInfo processInfo].arguments containsObject:@"StringToUseMockObjects"]) {

        // Use your mock object here

    }
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Добавлять проверку, указанную выше, необходимо в таргете приложения - не в
тестовом. С примером применения UITests можно ознакомиться
[здесь](<https://github.com/iQueSoft/iOSDemo_UITests>). Это такой же пример, как
и выше, только для тестирования используются UI Tests вместо KIF.

На мой взгляд, использование встроенного механизма тестирования UI является
проще и надежнее, чем использование сторонних решений. Компания Apple также
предоставляет возможности поиска и устранения ошибок в самих тестах. Отсутствие
возможности протестировать UI не хватало для полноты CI предоставляемого
компанией Apple. В новой 7й версии Xcode они восполнили этот пробел.

Пока-что существенным недостатком тестирования UI в Xcode, является то, что его
можно проводить только в iOS 9, а большинство приложений поддерживает iOS 7 и
выше. Однако, количество девайсов использующих iOS 9 постоянно растет. По
данным, предоставляемым Apple на 30 ноября 2015, iOS 9 установлена на 70%
девайсов (https://developer.apple.com/support/app-store/).

![](<iOS_usage_statistics.png>)

  И очень скоро тестирование UI только в iOS 9 перестанет быть большим
недостатком :)
